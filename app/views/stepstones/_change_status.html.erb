<% if user_signed_in? %>

  <% step = stepstone.step_of(current_user) %>

  <% if step.nil? %>

    <%= form_for Step.new(user:current_user, stepstone:stepstone, aasm_state:'working') do |f| %>
      <%= f.hidden_field(:user_id) %>
      <%= f.hidden_field(:stepstone_id) %>
      <%= f.hidden_field(:aasm_state) %>
      <%= f.submit "start working on #{no}. step" %>
    <% end %>

  <% else %>

    <%= form_for step do |f| %>
      <%= f.select(
           :aasm_state, 
           options_for_select(
           Step.statuses, 
           step.aasm_state)) %>
      <%= f.submit 'set' %>
    <% end %>

  <% end %>

<% end %>