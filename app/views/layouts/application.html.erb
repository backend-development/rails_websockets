<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= content_for?(:title) ? yield(:title) : "Stepstones" %></title>
    <%= csrf_meta_tags %>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <%= stylesheet_link_tag "application", :media => "all" %>

  </head>
  <body>

    <div class="navbar navbar-fluid-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <%= link_to "Stepstones", root_path, :class => "brand" %>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li><%= link_to "Adventures", adventures_path  %></li>
              
                <li class="user-signed-in divider-vertical"></li>
                <li class="user-signed-in"><%= link_to 'Edit profile', edit_user_registration_path %> </li>
                <li class="user-signed-in"><%= link_to "Logout", destroy_user_session_path, method: :delete %></li>

                <li class="user-anon divider-vertical"></li>
                <li class="user-anon"><%= link_to "Sign up", new_user_registration_path %> </li>
                <li class="user-anon"><%= link_to "Login", new_user_session_path %></li>

            </ul>
            <p class="navbar-text pull-right">
              <span class="user-anon nojs">To Login you need Javascript</span>
              <span class="user-anon">Not logged in</span>
              <span class="user-signed-in">Logged in as <strong class="show_currentuser_nickname"></strong></span>
            </p>

          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <div id="flash_messages">
          </div>
          <%= yield %>
        </div>
        <div class="span3">
          <% if content_for?(:sidebar) %>
            <div class="btn-group btn-group-vertical">
              <h4>What can I do?</h4>
              <%= yield(:sidebar) %>
            </div><!--/.sigebar-nav -->
          <% else %>
            <div class="stepstone_image">
            </div>
          <% end %>
        </div><!--/span-->
      </div><!--/row-->

      <footer>
      <p>&copy; <a href="http://brigitte-jellinek.at">Brigitte Jellinek</a> 2012</p>
      </footer>

    </div> <!-- /container -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <%= javascript_include_tag "application" %>
    <script>
      $('.nojs').hide();
      var Stepstones = {};
      Stepstones.onCurrentUser = function() {
        if( Stepstones.current_user ) {
          $('.show_currentuser_nickname').html( Stepstones.current_user.nickname );
          $('.user-anon').hide();
          $('.user-signed-in').show();
        }
        if( Stepstones.flash ) {
          var html = "";
          for( type in Stepstones.flash ) {
            if (type == 'timeout') continue;
            if (type == 'timedout') continue;
            html += "<div class='alert fade in alert-" + type + "'><button class='close' data-dismiss='alert'>&times;</button>" 
                 +  Stepstones.flash[type]
                 +  "</div>";
          }
          if (html.length) {
            $('#flash_messages').html(html);
          }
        }
      };
      $.getJSON('/me.json', function(data){
          Stepstones.current_user = data.current_user;
          Stepstones.flash        = data.flash;
          console.log("loaded data for current user")
          console.dir(Stepstones.current_user)
          console.log("loaded data for flash")
          console.dir(Stepstones.flash)
          Stepstones.onCurrentUser();
      });
    </script>

  </body>
</html>
